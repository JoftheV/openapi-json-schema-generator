{{#with operation}}
package {{packageName}}.{{subpackage}};

import org.checkerframework.checker.nullness.qual.Nullable;
    {{#each builders}}
        {{#each keyToBuilder}}
            {{#with property}}
                {{#if containerJsonPathPiece}}
import {{packageName}}.{{subpackage}}.{{containerJsonPathPiece.pascalCase}};
                {{else}}
                    {{#if subpackage}}
import {{packageName}}.{{subpackage}}.{{jsonPathPiece.pascalCase}};
                    {{else}}
import {{packageName}}.{{jsonPathPiece.pascalCase}};
                    {{/if}}
                {{/if}}
            {{/with}}
        {{/each}}
    {{/each}}
    {{#with parametersInfo}}
import {{packageName}}.{{subpackage}}.{{jsonPathPiece.pascalCase}};
    {{/with}}
    {{#with responses}}
import {{packageName}}.{{subpackage}}.{{jsonPathPiece.pascalCase}};
    {{/with}}

public class {{jsonPathPiece.pascalCase}} {
    {{#eq builders.size 1}}

    public static class {{jsonPathPiece.pascalCase}}Request {
        {{#each builders}}
            {{#each keyToBuilder}}
                {{#with property}}
                    {{#if containerJsonPathPiece}}
        public {{containerJsonPathPiece.pascalCase}}.@Nullable {{operationInputClassName}} {{@key.camelCase}};
                    {{else}}
                        {{#if subpackage}}
        public {{jsonPathPiece.pascalCase}}.@Nullable {{operationInputClassName}} {{@key.camelCase}};
                        {{else}}
        public {{jsonPathPiece.pascalCase}}.@Nullable {{operationInputClassName}} {{@key.camelCase}};
                        {{/if}}
                    {{/if}}
                {{/with}}
            {{/each}}
        {{/each}}
    }
    {{else}}

    public static class {{jsonPathPiece.pascalCase}}Request {
        {{#each (reverse builders)}}
            {{#or @first @last}}
                {{#each keyToBuilder}}
                    {{#with property}}
                        {{#if containerJsonPathPiece}}
        public {{containerJsonPathPiece.pascalCase}}.{{#if ../../@last}}@Nullable {{/if}}{{operationInputClassName}} {{@key.camelCase}};
                        {{else}}
                            {{#if subpackage}}
        public {{jsonPathPiece.pascalCase}}.{{#if ../../@last}}@Nullable {{/if}}{{operationInputClassName}} {{@key.camelCase}};
                            {{else}}
        public {{jsonPathPiece.pascalCase}}.{{#if ../../@last}}@Nullable {{/if}}{{operationInputClassName}} {{@key.camelCase}};
                            {{/if}}
                        {{/if}}
                    {{/with}}
                {{/each}}
            {{/or}}
        {{/each}}

        public {{jsonPathPiece.pascalCase}}Request(
        {{#each (reverse builders)}}
            {{#or @first @last}}
                {{#each keyToBuilder}}
                    {{#with property}}
                        {{#if containerJsonPathPiece}}
            {{containerJsonPathPiece.pascalCase}}.{{#if ../../@last}}@Nullable {{/if}}{{operationInputClassName}} {{@key.camelCase}}{{#and ../../@last ../@last}}{{else}},{{/and}}
                        {{else}}
            {{jsonPathPiece.pascalCase}}.{{#if ../../@last}}@Nullable {{/if}}{{operationInputClassName}} {{@key.camelCase}}{{#and ../../@last ../@last}}{{else}},{{/and}}
                        {{/if}}
                    {{/with}}
                {{/each}}
            {{/or}}
        {{/each}}
        ) {
        {{#each (reverse builders)}}
            {{#or @first @last}}
                {{#each keyToBuilder}}
            this.{{@key.camelCase}} = {{@key.camelCase}};
                {{/each}}
            {{/or}}
        {{/each}}
        }
    }

    public static class {{jsonPathPiece.pascalCase}}NullableRequest {
        {{#each (reverse builders)}}
            {{#or @first @last}}
                {{#each keyToBuilder}}
                    {{#with property}}
                        {{#if containerJsonPathPiece}}
        public {{containerJsonPathPiece.pascalCase}}.@Nullable {{operationInputClassName}} {{@key.camelCase}};
                        {{else}}
                            {{#if subpackage}}
        public {{jsonPathPiece.pascalCase}}.@Nullable {{operationInputClassName}} {{@key.camelCase}};
                            {{else}}
        public {{jsonPathPiece.pascalCase}}.@Nullable {{operationInputClassName}} {{@key.camelCase}};
                            {{/if}}
                        {{/if}}
                    {{/with}}
                {{/each}}
            {{/or}}
        {{/each}}
    }
    {{/eq}}
    {{#each builders}}
        {{#or @first @last}}
            {{#each keyToBuilder}}

    public interface SetterFor{{@key.pascalCase}} <T> {
        {{../../jsonPathPiece.pascalCase}}{{#gt ../../builders.size 1}}Nullable{{/gt}}Request getInstance();
        T getBuilderAfter{{@key.pascalCase}}({{../../jsonPathPiece.pascalCase}}{{#gt ../../builders.size 1}}Nullable{{/gt}}Request instance);
        default T {{@key.camelCase}}({{#with property}}{{#if containerJsonPathPiece}}{{containerJsonPathPiece.pascalCase}}{{else}}{{jsonPathPiece.pascalCase}}{{/if}}.{{operationInputClassName}}{{/with}} {{@key.camelCase}}) {
            var instance = getInstance();
            instance.{{@key.camelCase}} = {{@key.camelCase}};
            return getBuilderAfter{{@key.pascalCase}}(instance);
        }
    }
            {{/each}}
        {{/or}}
    {{/each}}

    {{#each builders}}
    public static class {{className.pascalCase}}{{#if keyToBuilder}} implements {{/if}}{{#each keyToBuilder}}SetterFor{{@key.pascalCase}}<{{builder.className.pascalCase}}>{{#unless @last}}, {{/unless}}{{/each}} {
        private final {{../jsonPathPiece.pascalCase}}{{#gt ../builders.size 1}}Nullable{{/gt}}Request instance;

        {{#if @last }}
        public {{className.pascalCase}}() {
            this.instance = new {{../jsonPathPiece.pascalCase}}{{#gt ../builders.size 1}}Nullable{{/gt}}Request();
        }
        {{else}}
        public {{className.pascalCase}}({{../jsonPathPiece.pascalCase}}{{#gt ../builders.size 1}}Nullable{{/gt}}Request instance) {
            this.instance = instance;
        }
        {{/if}}
        {{#if @first}}

        public {{../jsonPathPiece.pascalCase}}Request build() {
        {{#gt ../builders.size 1}}
            {{#each (reverse builders)}}
                {{#unless @last}}
                    {{#each keyToBuilder}}
            var {{@key.camelCase}} = instance.{{@key.camelCase}};
            if ({{@key.camelCase}} == null) {
                throw new RuntimeException("invalid null value for required parameter");
            }
                    {{/each}}
                {{/unless}}
            {{/each}}
            return new {{../jsonPathPiece.pascalCase}}Request(
            {{#each (reverse builders)}}
                {{#each keyToBuilder}}
                {{#if ../@last}}instance.{{/if}}{{@key.camelCase}}{{#and ../@last @last}}{{else}},{{/and}}
                {{/each}}
            {{/each}}
            );
        {{else}}
            return instance;
        {{/gt}}
        }
        {{/if}}
        {{#if keyToBuilder}}

        public {{../jsonPathPiece.pascalCase}}{{#gt ../builders.size 1}}Nullable{{/gt}}Request getInstance() {
            return instance;
        }
        {{/if}}
        {{#each keyToBuilder}}

        public {{builder.className.pascalCase}} getBuilderAfter{{@key.pascalCase}}({{../jsonPathPiece.pascalCase}}{{#gt ../builders.size 1}}Nullable{{/gt}}Request instance) {
            {{#eq builder ../this}}
                {{! property in final builder }}
            return this;
            {{else}}
            return new {{builder.className.pascalCase}}(instance);
            {{/eq}}
        }
        {{/each}}
    }
    {{/each}}
}
{{/with}}
